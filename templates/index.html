<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini AI Chat</title>
  <style>
    :root{
      --bg:#f5f7fb; --card:#fff; --border:#e6e8ee; --text:#0f172a; --muted:#64748b;
      --bot-bubble:#f1f5f9; --user-bubble:#2563eb; --user-text:#fff; --accent:#2563eb;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1220; --card:#0f172a; --border:#1f2a44; --text:#e5e7eb; --muted:#94a3b8; --bot-bubble:#111827;
        --user-bubble:#2563eb; --user-text:#fff;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(37,99,235,.15), transparent 60%),
        radial-gradient(1000px 500px at 110% 110%, rgba(16,185,129,.12), transparent 60%),
        var(--bg);
      color:var(--text); display:grid; place-items:center; padding:24px;
    }
    .chat-card{
      width:min(900px,100%); height:min(80vh,900px); background:var(--card);
      border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
      display:grid; grid-template-rows:auto 1fr auto; overflow:hidden;
    }
    .chat-header{ padding:16px 18px; border-bottom:1px solid var(--border); display:flex; gap:12px; align-items:center; background:linear-gradient(180deg, rgba(0,0,0,.02), transparent) }
    .logo{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:#111827; color:#fff; font-weight:700 }
    .title{ font-weight:700 } .subtitle{ color:var(--muted); font-size:13px }
    .messages{ padding:18px; overflow:auto; background: radial-gradient(450px 120px at 80% 0%, rgba(37,99,235,.05), transparent 60%), linear-gradient(180deg, transparent, transparent 60%, rgba(0,0,0,.02)) }
    .msg{ display:flex; gap:10px; margin:8px 0; align-items:flex-end }
    .msg.bot{ justify-content:flex-start } .msg.user{ justify-content:flex-end }
    .avatar{ width:32px; height:32px; flex:0 0 32px; border-radius:50%; display:grid; place-items:center; background:#0f172a; color:#fff; font-size:14px; font-weight:700; user-select:none }
    .avatar.user{ background:#1d4ed8 }
    .bubble{ max-width:70ch; padding:10px 12px; border-radius:14px; line-height:1.4; border:1px solid var(--border); white-space:pre-wrap; word-wrap:break-word }
    .bot .bubble{ background:var(--bot-bubble) }
    .user .bubble{ background:var(--user-bubble); color:var(--user-text); border-color:transparent }
    .meta{ margin-top:4px; font-size:12px; color:var(--muted) }
    .typing{ display:flex; gap:6px; color:var(--muted) }
    .typing span{ width:6px; height:6px; border-radius:50%; background: currentColor; opacity:.5; animation:bounce 1.2s infinite ease-in-out; display:inline-block }
    .typing span:nth-child(2){ animation-delay:.15s } .typing span:nth-child(3){ animation-delay:.3s }
    @keyframes bounce{ 0%,80%,100%{transform:translateY(0);opacity:.4} 40%{ transform:translateY(-5px); opacity:1 } }
    .composer{ border-top:1px solid var(--border); padding:12px; background:linear-gradient(180deg, transparent, rgba(0,0,0,.02)) }
    .composer form{ display:flex; gap:10px }
    .composer input[type="text"]{ flex:1; padding:12px 14px; border:1px solid var(--border); border-radius:12px; background:var(--card); color:var(--text) }
    .composer button{ padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:var(--accent); color:#fff; font-weight:600 }
    .composer button[disabled]{ opacity:.6; cursor:not-allowed }
    .messages::-webkit-scrollbar{ width:10px } .messages::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.1); border-radius:8px; border:2px solid transparent; background-clip:padding-box }
    .status{ margin-left:auto; font-size:12px; color:var(--muted) }
  </style>
</head>
<body>
  <main class="chat-card" aria-label="Chat window">
    <header class="chat-header">
      <div class="logo">AI</div>
      <div class="titles">
        <div class="title">Mini AI Chat</div>
        <div class="subtitle">Flask â€¢ same origin (no CORS)</div>
      </div>
      <div class="status" id="status">â€¢ online</div>
    </header>

    <section class="messages" id="messages" role="log" aria-live="polite" aria-atomic="false">
      <div class="msg bot">
        <div class="avatar bot" aria-hidden="true">ðŸ¤–</div>
        <div class="bubble">
          Hello! Iâ€™m your local Python-only chatbot. Ask me the time, tell me your name, or just say hi.
          <div class="meta">Bot</div>
        </div>
      </div>
    </section>

    <section class="composer" aria-label="Message composer">
      <form id="form">
        <input id="input" type="text" name="message" placeholder="Type a messageâ€¦" autocomplete="off" />
        <button id="send" type="submit">Send</button>
      </form>
    </section>
  </main>

  <script>
    const el = {
      messages: document.getElementById("messages"),
      form: document.getElementById("form"),
      input: document.getElementById("input"),
      send: document.getElementById("send"),
      status: document.getElementById("status"),
    };

    let pending = false;
    let typingNode = null;

    function addMessage(kind, text, meta) {
      const wrap = document.createElement("div");
      wrap.className = "msg " + kind;

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;

      const metaDiv = document.createElement("div");
      metaDiv.className = "meta";
      metaDiv.textContent = meta || (kind === "user" ? "You" : "Bot");
      bubble.appendChild(metaDiv);

      if (kind === "bot") {
        const avatar = document.createElement("div");
        avatar.className = "avatar bot";
        avatar.textContent = "ðŸ¤–";
        wrap.appendChild(avatar);
        wrap.appendChild(bubble);
      } else {
        wrap.appendChild(bubble);
        const avatar = document.createElement("div");
        avatar.className = "avatar user";
        avatar.textContent = "Y";
        wrap.appendChild(avatar);
      }

      el.messages.appendChild(wrap);
      el.messages.scrollTop = el.messages.scrollHeight;
      return wrap;
    }

    function showTyping() {
      const wrap = document.createElement("div");
      wrap.className = "msg bot";
      const avatar = document.createElement("div");
      avatar.className = "avatar bot";
      avatar.textContent = "ðŸ¤–";
      const bubble = document.createElement("div");
      bubble.className = "bubble typing";
      bubble.setAttribute("aria-label", "Bot is typing");
      bubble.innerHTML = "<span></span><span></span><span></span>";
      wrap.appendChild(avatar);
      wrap.appendChild(bubble);
      el.messages.appendChild(wrap);
      el.messages.scrollTop = el.messages.scrollHeight;
      typingNode = wrap;
    }

    function hideTyping() {
      if (typingNode && typingNode.parentNode) typingNode.parentNode.removeChild(typingNode);
      typingNode = null;
    }

    function setPending(v) {
      pending = v;
      el.input.disabled = v;
      el.send.disabled = v;
    }

    async function sendMessage(text) {
      if (!text || pending) return;
      setPending(true);
      addMessage("user", text);

      showTyping();
      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text }),
        });
        const json = await res.json();
        hideTyping();

        if (!res.ok) {
          addMessage("bot", json.error || "Something went wrong.");
        } else {
          addMessage("bot", json.reply || "(no reply)");
        }
      } catch (e) {
        hideTyping();
        addMessage("bot", "Cannot reach /chat. Is the server running?");
        el.status.textContent = "â€¢ offline";
      } finally {
        setPending(false);
      }
    }

    el.form.addEventListener("submit", (ev) => {
      ev.preventDefault();
      const text = el.input.value.trim();
      el.input.value = "";
      sendMessage(text);
    });

    el.input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        el.form.dispatchEvent(new Event("submit"));
      }
    });
  </script>
</body>
</html>
